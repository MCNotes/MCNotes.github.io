<!DOCTYPE html>
<html>
<!--custom header -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width initial-scale=1">

  <title> MC notes</title>
  <meta name="description" content="Open Data Science built upon Jupyter Notebooks">


  <link rel="shortcut icon" href="http://localhost:4000/images/dna.png" >

  <!-- Style sheets -->
  <!--Material bootstrap -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.3.0/css/mdb.min.css" rel="stylesheet" medial ="all">

  <!-- Font awesome -->
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" media="all">

  <!-- Boostrap-->
  <link rel="stylesheet" href="/css/main.css">


  <!-- URL -->
  <link rel="canonical" href="http://localhost:4000/notebook.html">


  <!-- The various JS scripts used in the website -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="https://use.fontawesome.com/ff95ae1185.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
  integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
  crossorigin="anonymous"></script>

<!-- add after bootstrap.min.js -->
<script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v0.4.1/dist/bootstrap-toc.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.3.0/js/mdb.min.js"></script>
<script src="/js/custom-scripts.js"></script>
<script src="/js/mdb.min.js"></script>

<!-- github js-->
<!-- Place this tag in your head or just before your close body tag. -->
<script async defer src="https://buttons.github.io/buttons.js"></script>

<!-- Loading mathjax macro -->
<!-- Load mathjax -->
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    </script>

    <!-- Animations init-->
    <script>
        new WOW().init();
    </script>


</head>


<!-- Scroller for TOC-->
<body data-spy="scroll" data-target="#toc">


<!-- Main content needs to be in a wrap for
when the sidebar is displayed-->

<!-- nav bar-->
<!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation"
    id = 'top_nav'>
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse"
                data-target="#nav_collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href='http://localhost:4000' class="navbar-brand" >MC notes</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="nav_collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#about"> About </a>
                    </li>

                    <li>
                        <a href="#contact"> Volumes </a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>


<div class="header">
  <h1 class="header_logo">Analysis of variance</h1>
</div>

  <div class="container-fluid offset">
    <div class="row">


      <div class="col-md-10 col-md-offset-1">
        <h1 id="bad-day-2-anova">BAD DAY 2: ANOVA</h1>

<h1 id="analysis-of-variance-anova-models">1. Analysis of variance: ANOVA models</h1>

<p><br /></p>
<font color="#00bcd4"> In [1]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Setting the right working dir
</span><span class="w">
</span><span class="n">bad2dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getwd</span><span class="p">()</span><span class="w">
</span><span class="n">setwd</span><span class="p">(</span><span class="n">bad2dir</span><span class="p">)</span></code></pre></figure>

<p>Loading the data: in this case we ae going to work with the <code class="highlighter-rouge">growth1</code> data set
provided as art of this course. The data is contained within a <code class="highlighter-rouge">.csv</code> file.</p>

<p><br /></p>
<font color="#00bcd4"> In [2]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># data=read.delim('./Data/growth.txt',header=TRUE)
</span><span class="n">data1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s1">'./Data/growth1.csv'</span><span class="p">)</span></code></pre></figure>

<p>Letâ€™s first have a look at the dimension  of the data</p>

<p><br /></p>
<font color="#00bcd4"> In [3]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="nf">dim</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span></code></pre></figure>

<ol class="list-inline">
	<li>31</li>
	<li>2</li>
</ol>

<p>Printing the column names:</p>

<p><br /></p>
<font color="#00bcd4"> In [4]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">colnames</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span></code></pre></figure>

<ol class="list-inline">
	<li>'Growth'</li>
	<li>'Treatment'</li>
</ol>

<p>Getting a basic statistical summary on the data:</p>

<p><br /></p>
<font color="#00bcd4"> In [5]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">summary</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>     Growth        Treatment
 Min.   : 5.00   A      :7  
 1st Qu.:14.00   B      :5  
 Median :36.00   C      :5  
 Mean   :38.68   Control:4  
 3rd Qu.:61.50   D      :5  
 Max.   :83.00   E      :5  
</code></pre>
</div>

<p><br /></p>
<font color="#00bcd4"> In [6]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># making the objects in the dataframe accessible
</span><span class="n">attach</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span></code></pre></figure>

<p><br /></p>
<font color="#00bcd4"> In [7]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Treatment</span></code></pre></figure>

<ol class="list-inline">
	<li>C</li>
	<li>C</li>
	<li>C</li>
	<li>C</li>
	<li>C</li>
	<li>E</li>
	<li>E</li>
	<li>E</li>
	<li>E</li>
	<li>E</li>
	<li>D</li>
	<li>D</li>
	<li>D</li>
	<li>D</li>
	<li>D</li>
	<li>A</li>
	<li>A</li>
	<li>A</li>
	<li>A</li>
	<li>A</li>
	<li>A</li>
	<li>A</li>
	<li>B</li>
	<li>B</li>
	<li>B</li>
	<li>B</li>
	<li>B</li>
	<li>Control</li>
	<li>Control</li>
	<li>Control</li>
	<li>Control</li>
</ol>

<p>In this case we have a column for the <em>DEPENDENT</em> variable (Growth) and a column
for the  <em>FACTOR</em> (Treatment).</p>

<p>The first column contains numeric data but the second contains letters. It does
not matter to R which form you have your dependent factors (letters or numbers)
but it will be easier to interpret the results if you use meaningful names.</p>

<h3 id="ready-to-run-the-analysis">Ready to run the analysis.</h3>

<p><br /></p>
<font color="#00bcd4"> In [8]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">data.aov</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">Growth</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Treatment</span><span class="p">)</span></code></pre></figure>

<p>Notice here the symbol (a tilde) in the model. This means take Growth as the
DEPENDENT variable, indeed it depends on the Treatment.</p>

<p>We can then print the results of the analysis of variance</p>

<p><br /></p>
<font color="#00bcd4"> In [9]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#see the results: not very clear
</span><span class="n">data.aov</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>Call:
   aov(formula = Growth ~ Treatment)

Terms:
                Treatment Residuals
Sum of Squares  19459.167   973.607
Deg. of Freedom         5        25

Residual standard error: 6.240536
Estimated effects may be unbalanced
</code></pre>
</div>

<p>In order to get more information we need to view the analysis summary:</p>

<p><br /></p>
<font color="#00bcd4"> In [10]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">summary</span><span class="p">(</span><span class="n">data.aov</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>            Df Sum Sq Mean Sq F value   Pr(&gt;F)    
Treatment    5  19459    3892   99.93 1.07e-15 ***
Residuals   25    974      39                     
---
Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1
</code></pre>
</div>

<h1 id="post-hoc-testing">2. Post-hoc testing</h1>

<p>This was an example of a simple one-way anova. According to the summary we see
that there is a significant effect of Treatment upon Growth. However, there are
5 treatments!</p>

<p>It is crucial to know which of these treatments are significantly different from
the each other (e.g. control treatments). R provides a simple function to carry
out the Tukey HSD test.</p>

<p><br /></p>
<font color="#00bcd4"> In [11]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">TukeyHSD</span><span class="p">(</span><span class="n">data.aov</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = Growth ~ Treatment)

$Treatment
               diff        lwr        upr     p adj
B-A       -12.65714 -23.918244  -1.396042 0.0211539
C-A        47.54286  36.281756  58.803958 0.0000000
Control-A -18.10714 -30.161431  -6.052855 0.0012274
D-A        32.94286  21.681756  44.203958 0.0000000
E-A        38.54286  27.281756  49.803958 0.0000000
C-B        60.20000  48.036621  72.363379 0.0000000
Control-B  -5.45000 -18.351212   7.451212 0.7812490
D-B        45.60000  33.436621  57.763379 0.0000000
E-B        51.20000  39.036621  63.363379 0.0000000
Control-C -65.65000 -78.551212 -52.748788 0.0000000
D-C       -14.60000 -26.763379  -2.436621 0.0121584
E-C        -9.00000 -21.163379   3.163379 0.2390481
D-Control  51.05000  38.148788  63.951212 0.0000000
E-Control  56.65000  43.748788  69.551212 0.0000000
E-D         5.60000  -6.563379  17.763379 0.7157067
</code></pre>
</div>

<h1 id="two-way-anova">3. Two way ANOVA</h1>

<p>Loading the data to be used</p>

<p><br /></p>
<font color="#00bcd4"> In [12]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">data2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s1">'./Data/growth2.csv'</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span></code></pre></figure>

<ol class="list-inline">
	<li>'Growth'</li>
	<li>'Treatment'</li>
	<li>'Gender'</li>
</ol>

<p><br /></p>
<font color="#00bcd4"> In [13]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">detach</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span><span class="w">  </span><span class="c1"># detach the previoulsy attached data set
</span><span class="n">attach</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">making</span><span class="w"> </span><span class="n">data2</span><span class="w"> </span><span class="n">accessible</span></code></pre></figure>

<p><br /></p>
<font color="#00bcd4"> In [14]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Gender</span></code></pre></figure>

<ol class="list-inline">
	<li>M</li>
	<li>M</li>
	<li>M</li>
	<li>F</li>
	<li>F</li>
	<li>F</li>
	<li>F</li>
	<li>M</li>
	<li>M</li>
	<li>M</li>
	<li>F</li>
	<li>F</li>
	<li>F</li>
	<li>M</li>
	<li>M</li>
	<li>M</li>
	<li>F</li>
	<li>F</li>
	<li>M</li>
	<li>M</li>
	<li>M</li>
	<li>F</li>
	<li>F</li>
	<li>F</li>
	<li>M</li>
	<li>M</li>
	<li>M</li>
	<li>F</li>
	<li>F</li>
	<li>M</li>
	<li>M</li>
	<li>F</li>
	<li>F</li>
	<li>M</li>
	<li>M</li>
</ol>

<p><br /></p>
<font color="#00bcd4"> In [15]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Treatment</span></code></pre></figure>

<ol class="list-inline">
	<li>C</li>
	<li>C</li>
	<li>C</li>
	<li>C</li>
	<li>C</li>
	<li>E</li>
	<li>E</li>
	<li>E</li>
	<li>E</li>
	<li>E</li>
	<li>D</li>
	<li>D</li>
	<li>D</li>
	<li>D</li>
	<li>D</li>
	<li>A</li>
	<li>A</li>
	<li>A</li>
	<li>A</li>
	<li>A</li>
	<li>A</li>
	<li>A</li>
	<li>B</li>
	<li>B</li>
	<li>B</li>
	<li>B</li>
	<li>B</li>
	<li>Control</li>
	<li>Control</li>
	<li>Control</li>
	<li>Control</li>
	<li>Control</li>
	<li>Control</li>
	<li>Control</li>
	<li>Control</li>
</ol>

<p><br /></p>
<font color="#00bcd4"> In [16]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="nf">length</span><span class="p">(</span><span class="n">Gender</span><span class="p">)</span></code></pre></figure>

<p>35</p>

<p>We can compare the two times or the two shoes by looking at summary statistics
or at parallel boxplots. To get the means for each level of each factor, use Râ€™s
tapply command.</p>

<p>This takes three arguments: the data you wish to summarize, the factor that
determines the groups, and the function you wish to apply to each of the groups.</p>

<p>First we will compute the mean Growth as a function of the Treatment type:</p>

<p><br /></p>
<font color="#00bcd4"> In [17]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">tapply</span><span class="p">(</span><span class="n">Growth</span><span class="p">,</span><span class="w"> </span><span class="n">Treatment</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span></code></pre></figure>

<dl class="dl-horizontal">
	<dt>A</dt>
		<dd>23.8571428571429</dd>
	<dt>B</dt>
		<dd>11.2</dd>
	<dt>C</dt>
		<dd>71.4</dd>
	<dt>Control</dt>
		<dd>6</dd>
	<dt>D</dt>
		<dd>56.8</dd>
	<dt>E</dt>
		<dd>62.4</dd>
</dl>

<p><br /></p>
<font color="#00bcd4"> In [18]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">boxplot</span><span class="p">(</span><span class="n">Growth</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Treatment</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Growth'</span><span class="p">,</span><span class="w">
       </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s1">'Treatment'</span><span class="p">)</span></code></pre></figure>

<p><img src="http://localhost:4000/notebooks/AoV_R_Notebook_files/AoV_R_Notebook_31_0.png" alt="png" /></p>

<p>Now we will compute the mean growth as a function of age:</p>

<p><br /></p>
<font color="#00bcd4"> In [39]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">tapply</span><span class="p">(</span><span class="n">Growth</span><span class="p">,</span><span class="w"> </span><span class="n">Gender</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span></code></pre></figure>

<dl class="dl-horizontal">
	<dt>F</dt>
		<dd>36.5625</dd>
	<dt>M</dt>
		<dd>33.6315789473684</dd>
</dl>

<p><br /></p>
<font color="#00bcd4"> In [20]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">boxplot</span><span class="p">(</span><span class="n">Growth</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Gender</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'lightblue2'</span><span class="p">,</span><span class="w"> </span><span class="s1">'mediumpurple'</span><span class="p">),</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Gender'</span><span class="p">,</span><span class="w">
        </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Growth'</span><span class="p">)</span></code></pre></figure>

<p><img src="http://localhost:4000/notebooks/AoV_R_Notebook_files/AoV_R_Notebook_34_0.png" alt="png" /></p>

<p>Comparing the two sets of means, we could draw the following preliminary
conclusions:
* Females grow more
* The most effective treatment is E</p>

<p>But that could just be due to natural variability. We can check if this is the
case by using a two way ANOVA analysis.</p>

<p><strong>We prefer to start with a model taking into account the interaction between
Gender and Treatment:</strong></p>

<p><br /></p>
<font color="#00bcd4"> In [21]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">int</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">Growth</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Gender</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Treatment</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">int</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>                 Df Sum Sq Mean Sq F value Pr(&gt;F)    
Gender            1     75      75   2.272  0.145    
Treatment         5  23208    4642 141.340 &lt;2e-16 ***
Gender:Treatment  5    129      26   0.783  0.572    
Residuals        23    755      33                   
---
Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1
</code></pre>
</div>

<p>The p-value for the interaction term is $Â»0.05$ (not significant).
This suggests we do not have to worry about their interaction!</p>

<p>So we repeat the process using a simple additive model.</p>

<p><br /></p>
<font color="#00bcd4"> In [22]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">noint</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">Growth</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Gender</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Treatment</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">noint</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)    
Gender       1     75      75   2.364  0.135    
Treatment    5  23208    4642 147.041 &lt;2e-16 ***
Residuals   28    884      32                   
---
Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1
</code></pre>
</div>

<p>As you can see p-values for the Gender variable is quite large, suggesting
that any effect we saw could well have been due to chance!</p>

<h2 id="n-way-analysis-of-variance">4. N-way analysis of variance</h2>

<p>This example will use the dataset <code class="highlighter-rouge">npk(Nitrogen - N, Phosphate - P, Potassium -
K)</code> that is available in R with the MASS library (Modern Applied Statistics with
S)</p>

<p><br /></p>
<font color="#00bcd4"> In [23]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">MASS</span><span class="p">)</span></code></pre></figure>

<p><br /></p>
<font color="#00bcd4"> In [24]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">npk</span><span class="w">
</span><span class="n">replications</span><span class="p">(</span><span class="n">yield</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">npk</span><span class="p">)</span></code></pre></figure>

<table class="table-responsive table-striped">
<thead><tr><th scope="col">block</th><th scope="col">N</th><th scope="col">P</th><th scope="col">K</th><th scope="col">yield</th></tr></thead>
<tbody>
	<tr><td>1   </td><td>0   </td><td>1   </td><td>1   </td><td>49.5</td></tr>
	<tr><td>1   </td><td>1   </td><td>1   </td><td>0   </td><td>62.8</td></tr>
	<tr><td>1   </td><td>0   </td><td>0   </td><td>0   </td><td>46.8</td></tr>
	<tr><td>1   </td><td>1   </td><td>0   </td><td>1   </td><td>57.0</td></tr>
	<tr><td>2   </td><td>1   </td><td>0   </td><td>0   </td><td>59.8</td></tr>
	<tr><td>2   </td><td>1   </td><td>1   </td><td>1   </td><td>58.5</td></tr>
	<tr><td>2   </td><td>0   </td><td>0   </td><td>1   </td><td>55.5</td></tr>
	<tr><td>2   </td><td>0   </td><td>1   </td><td>0   </td><td>56.0</td></tr>
	<tr><td>3   </td><td>0   </td><td>1   </td><td>0   </td><td>62.8</td></tr>
	<tr><td>3   </td><td>1   </td><td>1   </td><td>1   </td><td>55.8</td></tr>
	<tr><td>3   </td><td>1   </td><td>0   </td><td>0   </td><td>69.5</td></tr>
	<tr><td>3   </td><td>0   </td><td>0   </td><td>1   </td><td>55.0</td></tr>
	<tr><td>4   </td><td>1   </td><td>0   </td><td>0   </td><td>62.0</td></tr>
	<tr><td>4   </td><td>1   </td><td>1   </td><td>1   </td><td>48.8</td></tr>
	<tr><td>4   </td><td>0   </td><td>0   </td><td>1   </td><td>45.5</td></tr>
	<tr><td>4   </td><td>0   </td><td>1   </td><td>0   </td><td>44.2</td></tr>
	<tr><td>5   </td><td>1   </td><td>1   </td><td>0   </td><td>52.0</td></tr>
	<tr><td>5   </td><td>0   </td><td>0   </td><td>0   </td><td>51.5</td></tr>
	<tr><td>5   </td><td>1   </td><td>0   </td><td>1   </td><td>49.8</td></tr>
	<tr><td>5   </td><td>0   </td><td>1   </td><td>1   </td><td>48.8</td></tr>
	<tr><td>6   </td><td>1   </td><td>0   </td><td>1   </td><td>57.2</td></tr>
	<tr><td>6   </td><td>1   </td><td>1   </td><td>0   </td><td>59.0</td></tr>
	<tr><td>6   </td><td>0   </td><td>1   </td><td>1   </td><td>53.2</td></tr>
	<tr><td>6   </td><td>0   </td><td>0   </td><td>0   </td><td>56.0</td></tr>
</tbody>
</table>

<dl class="dl-horizontal">
	<dt>N</dt>
		<dd>12</dd>
	<dt>P</dt>
		<dd>12</dd>
	<dt>K</dt>
		<dd>12</dd>
	<dt>N:P</dt>
		<dd>6</dd>
	<dt>N:K</dt>
		<dd>6</dd>
	<dt>P:K</dt>
		<dd>6</dd>
	<dt>N:P:K</dt>
		<dd>3</dd>
</dl>

<p><br /></p>
<font color="#00bcd4"> In [25]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#tapply
</span><span class="err">#</span><span class="o">?</span><span class="n">npk</span></code></pre></figure>

<p><br /></p>
<font color="#00bcd4"> In [26]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">with</span><span class="p">(</span><span class="n">npk</span><span class="p">,</span><span class="w"> </span><span class="n">tapply</span><span class="p">(</span><span class="n">yield</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">P</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="p">))</span></code></pre></figure>

<table class="table-responsive table-striped">
<thead><tr><th></th><th scope="col">0</th><th scope="col">1</th></tr></thead>
<tbody>
	<tr><th scope="row">0</th><td>51.71667</td><td>52.41667</td></tr>
	<tr><th scope="row">1</th><td>59.21667</td><td>56.15000</td></tr>
</tbody>
</table>

<p><br /></p>
<font color="#00bcd4"> In [27]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">with</span><span class="p">(</span><span class="n">npk</span><span class="p">,</span><span class="w"> </span><span class="n">tapply</span><span class="p">(</span><span class="n">yield</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">K</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="p">))</span></code></pre></figure>

<table class="table-responsive table-striped">
<thead><tr><th></th><th scope="col">0</th><th scope="col">1</th></tr></thead>
<tbody>
	<tr><th scope="row">0</th><td>52.88333</td><td>51.25000</td></tr>
	<tr><th scope="row">1</th><td>60.85000</td><td>54.51667</td></tr>
</tbody>
</table>

<p><br /></p>
<font color="#00bcd4"> In [28]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">with</span><span class="p">(</span><span class="n">npk</span><span class="p">,</span><span class="w"> </span><span class="n">tapply</span><span class="p">(</span><span class="n">yield</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">K</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="p">))</span></code></pre></figure>

<table class="table-responsive table-striped">
<thead><tr><th></th><th scope="col">0</th><th scope="col">1</th></tr></thead>
<tbody>
	<tr><th scope="row">0</th><td>57.60000</td><td>53.33333</td></tr>
	<tr><th scope="row">1</th><td>56.13333</td><td>52.43333</td></tr>
</tbody>
</table>

<p><br /></p>
<font color="#00bcd4"> In [29]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">npk.aov</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">yield</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">npk</span><span class="p">)</span></code></pre></figure>

<p><br /></p>
<font color="#00bcd4"> In [30]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">TukeyHSD</span><span class="p">(</span><span class="n">npk.aov</span><span class="p">,</span><span class="w"> </span><span class="n">conf.level</span><span class="o">=</span><span class="m">.99</span><span class="p">);</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>  Tukey multiple comparisons of means
    99% family-wise confidence level

Fit: aov(formula = yield ~ N * P * K, data = npk)

$N
        diff        lwr      upr     p adj
1-0 5.616667 -0.9927112 12.22604 0.0245421

$P
         diff       lwr      upr     p adj
1-0 -1.183333 -7.792711 5.426044 0.6081875

$K
         diff       lwr      upr     p adj
1-0 -3.983333 -10.59271 2.626044 0.0974577

$`N:P`
             diff        lwr       upr     p adj
1:0-0:0  7.500000  -4.248642 19.248642 0.1294203
0:1-0:0  0.700000 -11.048642 12.448642 0.9961506
1:1-0:0  4.433333  -7.315308 16.181975 0.5257140
0:1-1:0 -6.800000 -18.548642  4.948642 0.1873570
1:1-1:0 -3.066667 -14.815308  8.681975 0.7743737
1:1-0:1  3.733333  -8.015308 15.481975 0.6554324

$`N:K`
             diff        lwr       upr     p adj
1:0-0:0  7.966667  -3.781975 19.715308 0.0999349
0:1-0:0 -1.633333 -13.381975 10.115308 0.9554188
1:1-0:0  1.633333 -10.115308 13.381975 0.9554188
0:1-1:0 -9.600000 -21.348642  2.148642 0.0382331
1:1-1:0 -6.333333 -18.081975  5.415308 0.2364506
1:1-0:1  3.266667  -8.481975 15.015308 0.7399770

$`P:K`
             diff       lwr       upr     p adj
1:0-0:0 -1.466667 -13.21531 10.281975 0.9670135
0:1-0:0 -4.266667 -16.01531  7.481975 0.5562955
1:1-0:0 -5.166667 -16.91531  6.581975 0.3986648
0:1-1:0 -2.800000 -14.54864  8.948642 0.8176375
1:1-1:0 -3.700000 -15.44864  8.048642 0.6615998
1:1-0:1 -0.900000 -12.64864 10.848642 0.9919305

$`N:P:K`
                    diff        lwr       upr     p adj
1:0:0-0:0:0  12.33333333  -7.121667 31.788334 0.1841773
0:1:0-0:0:0   2.90000000 -16.555001 22.355001 0.9975401
1:1:0-0:0:0   6.50000000 -12.955001 25.955001 0.8280891
0:0:1-0:0:0   0.56666667 -18.888334 20.021667 1.0000000
1:0:1-0:0:0   3.23333333 -16.221667 22.688334 0.9952141
0:1:1-0:0:0  -0.93333333 -20.388334 18.521667 0.9999987
1:1:1-0:0:0   2.93333333 -16.521667 22.388334 0.9973597
0:1:0-1:0:0  -9.43333333 -28.888334 10.021667 0.4627120
1:1:0-1:0:0  -5.83333333 -25.288334 13.621667 0.8902999
0:0:1-1:0:0 -11.76666667 -31.221667  7.688334 0.2249895
1:0:1-1:0:0  -9.10000000 -28.555001 10.355001 0.5045183
0:1:1-1:0:0 -13.26666667 -32.721667  6.188334 0.1303264
1:1:1-1:0:0  -9.40000000 -28.855001 10.055001 0.4668300
1:1:0-0:1:0   3.60000000 -15.855001 23.055001 0.9909550
0:0:1-0:1:0  -2.33333333 -21.788334 17.121667 0.9993808
1:0:1-0:1:0   0.33333333 -19.121667 19.788334 1.0000000
0:1:1-0:1:0  -3.83333333 -23.288334 15.621667 0.9870208
1:1:1-0:1:0   0.03333333 -19.421667 19.488334 1.0000000
0:0:1-1:1:0  -5.93333333 -25.388334 13.521667 0.8819049
1:0:1-1:1:0  -3.26666667 -22.721667 16.188334 0.9949094
0:1:1-1:1:0  -7.43333333 -26.888334 12.021667 0.7204567
1:1:1-1:1:0  -3.56666667 -23.021667 15.888334 0.9914323
1:0:1-0:0:1   2.66666667 -16.788334 22.121667 0.9985452
0:1:1-0:0:1  -1.50000000 -20.955001 17.955001 0.9999671
1:1:1-0:0:1   2.36666667 -17.088334 21.821667 0.9993214
0:1:1-1:0:1  -4.16666667 -23.621667 15.288334 0.9793323
1:1:1-1:0:1  -0.30000000 -19.755001 19.155001 1.0000000
1:1:1-0:1:1   3.86666667 -15.588334 23.321667 0.9863677
</code></pre>
</div>

<p><br /></p>
<font color="#00bcd4"> In [31]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Now plotting the results
</span><span class="n">plot</span><span class="p">(</span><span class="n">TukeyHSD</span><span class="p">(</span><span class="n">npk.aov</span><span class="p">,</span><span class="w"> </span><span class="n">conf.level</span><span class="o">=</span><span class="m">.99</span><span class="p">))</span></code></pre></figure>

<p><img src="http://localhost:4000/notebooks/AoV_R_Notebook_files/AoV_R_Notebook_50_0.png" alt="png" /></p>

<p><img src="http://localhost:4000/notebooks/AoV_R_Notebook_files/AoV_R_Notebook_50_1.png" alt="png" /></p>

<p><img src="http://localhost:4000/notebooks/AoV_R_Notebook_files/AoV_R_Notebook_50_2.png" alt="png" /></p>

<p><img src="http://localhost:4000/notebooks/AoV_R_Notebook_files/AoV_R_Notebook_50_3.png" alt="png" /></p>

<p><img src="http://localhost:4000/notebooks/AoV_R_Notebook_files/AoV_R_Notebook_50_4.png" alt="png" /></p>

<p><img src="http://localhost:4000/notebooks/AoV_R_Notebook_files/AoV_R_Notebook_50_5.png" alt="png" /></p>

<p><img src="http://localhost:4000/notebooks/AoV_R_Notebook_files/AoV_R_Notebook_50_6.png" alt="png" /></p>

<p><br /></p>
<font color="#00bcd4"> In [32]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">summary</span><span class="p">(</span><span class="n">npk.aov</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)  
N            1  189.3  189.28   6.161 0.0245 *
P            1    8.4    8.40   0.273 0.6082  
K            1   95.2   95.20   3.099 0.0975 .
N:P          1   21.3   21.28   0.693 0.4175  
N:K          1   33.1   33.14   1.078 0.3145  
P:K          1    0.5    0.48   0.016 0.9019  
N:P:K        1   37.0   37.00   1.204 0.2887  
Residuals   16  491.6   30.72                 
---
Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1
</code></pre>
</div>

<h2 id="final-diagnostic">5. Final Diagnostic</h2>

<ul>
  <li>Is an ANOVA analysis appropriate?</li>
  <li>Are the basics assumptions met?</li>
</ul>

<p>We should test for normality of data and homogeneity of variance.</p>

<ul>
  <li>
    <p>The Normal distribution can be tested by using a Q-Q plot: if the points
follow Q-Q line then data follow a normal distribution!</p>
  </li>
  <li>
    <p>Shapiro-Wilk test for normality tests a null hypothesis of normal data.</p>
  </li>
  <li>
    <p>The homogeneity of variance can be determined using the Bartlett Test of
Homogeneity or       Fligner-Killeen test of homogeneity of variances</p>
  </li>
</ul>

<p><br /></p>
<font color="#00bcd4"> In [33]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">plot</span><span class="p">(</span><span class="n">npk.aov</span><span class="p">)</span></code></pre></figure>

<p><img src="http://localhost:4000/notebooks/AoV_R_Notebook_files/AoV_R_Notebook_53_0.png" alt="png" /></p>

<p><img src="http://localhost:4000/notebooks/AoV_R_Notebook_files/AoV_R_Notebook_53_1.png" alt="png" /></p>

<p><img src="http://localhost:4000/notebooks/AoV_R_Notebook_files/AoV_R_Notebook_53_2.png" alt="png" /></p>

<p><img src="http://localhost:4000/notebooks/AoV_R_Notebook_files/AoV_R_Notebook_53_3.png" alt="png" /></p>

<p><br /></p>
<font color="#00bcd4"> In [34]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#plot.design(yield~N*P*K, data=npk);
</span><span class="err">#</span><span class="n">qqnorm</span><span class="p">(</span><span class="n">npk</span><span class="o">$</span><span class="n">yield</span><span class="p">);</span><span class="w"> </span><span class="n">qqline</span><span class="p">(</span><span class="n">npk</span><span class="o">$</span><span class="n">yield</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">4</span><span class="p">)</span></code></pre></figure>

<p><br /></p>
<font color="#00bcd4"> In [35]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">plot.design</span><span class="p">(</span><span class="n">yield</span><span class="o">~</span><span class="n">N</span><span class="o">*</span><span class="n">P</span><span class="o">*</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">npk</span><span class="p">);</span><span class="w">

</span><span class="n">qqnorm</span><span class="p">(</span><span class="n">npk</span><span class="o">$</span><span class="n">yield</span><span class="p">);</span><span class="w">
</span><span class="n">qqline</span><span class="p">(</span><span class="n">npk</span><span class="o">$</span><span class="n">yield</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'mediumpurple'</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span></code></pre></figure>

<p><img src="http://localhost:4000/notebooks/AoV_R_Notebook_files/AoV_R_Notebook_55_0.png" alt="png" /></p>

<p><img src="http://localhost:4000/notebooks/AoV_R_Notebook_files/AoV_R_Notebook_55_1.png" alt="png" /></p>

<p><br /></p>
<font color="#00bcd4"> In [36]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">by</span><span class="p">(</span><span class="n">npk</span><span class="o">$</span><span class="n">yield</span><span class="p">,</span><span class="w"> </span><span class="n">npk</span><span class="o">$</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">shapiro.test</span><span class="p">);</span><span class="w">
</span><span class="n">by</span><span class="p">(</span><span class="n">npk</span><span class="o">$</span><span class="n">yield</span><span class="p">,</span><span class="w"> </span><span class="n">npk</span><span class="o">$</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">shapiro.test</span><span class="p">);</span><span class="w">
</span><span class="n">by</span><span class="p">(</span><span class="n">npk</span><span class="o">$</span><span class="n">yield</span><span class="p">,</span><span class="w"> </span><span class="n">npk</span><span class="o">$</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">shapiro.test</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>npk$N: 0

	Shapiro-Wilk normality test

data:  dd[x, ]
W = 0.95781, p-value = 0.7522

------------------------------------------------------------
npk$N: 1

	Shapiro-Wilk normality test

data:  dd[x, ]
W = 0.96418, p-value = 0.8414




npk$P: 0

	Shapiro-Wilk normality test

data:  dd[x, ]
W = 0.96288, p-value = 0.824

------------------------------------------------------------
npk$P: 1

	Shapiro-Wilk normality test

data:  dd[x, ]
W = 0.95736, p-value = 0.7456




npk$K: 0

	Shapiro-Wilk normality test

data:  dd[x, ]
W = 0.97207, p-value = 0.9313

------------------------------------------------------------
npk$K: 1

	Shapiro-Wilk normality test

data:  dd[x, ]
W = 0.91886, p-value = 0.2766
</code></pre>
</div>

<p><br /></p>
<font color="#00bcd4"> In [37]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">bartlett.test</span><span class="p">(</span><span class="n">npk</span><span class="o">$</span><span class="n">yield</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">npk</span><span class="o">$</span><span class="n">N</span><span class="p">)</span><span class="w">
</span><span class="n">bartlett.test</span><span class="p">(</span><span class="n">npk</span><span class="o">$</span><span class="n">yield</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">npk</span><span class="o">$</span><span class="n">P</span><span class="p">)</span><span class="w">
</span><span class="n">bartlett.test</span><span class="p">(</span><span class="n">npk</span><span class="o">$</span><span class="n">yield</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">npk</span><span class="o">$</span><span class="n">K</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>	Bartlett test of homogeneity of variances

data:  npk$yield by npk$N
Bartlett's K-squared = 0.057652, df = 1, p-value = 0.8102





	Bartlett test of homogeneity of variances

data:  npk$yield by npk$P
Bartlett's K-squared = 0.1555, df = 1, p-value = 0.6933





	Bartlett test of homogeneity of variances

data:  npk$yield by npk$K
Bartlett's K-squared = 3.0059, df = 1, p-value = 0.08296
</code></pre>
</div>

<p><br /></p>
<font color="#00bcd4"> In [38]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">fligner.test</span><span class="p">(</span><span class="n">npk</span><span class="o">$</span><span class="n">yield</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">npk</span><span class="o">$</span><span class="n">N</span><span class="p">);</span><span class="w">
</span><span class="n">fligner.test</span><span class="p">(</span><span class="n">npk</span><span class="o">$</span><span class="n">yield</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">npk</span><span class="o">$</span><span class="n">P</span><span class="p">);</span><span class="w">
</span><span class="n">fligner.test</span><span class="p">(</span><span class="n">npk</span><span class="o">$</span><span class="n">yield</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">npk</span><span class="o">$</span><span class="n">K</span><span class="p">);</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>	Fligner-Killeen test of homogeneity of variances

data:  npk$yield by npk$N
Fligner-Killeen:med chi-squared = 0.010063, df = 1, p-value = 0.9201





	Fligner-Killeen test of homogeneity of variances

data:  npk$yield by npk$P
Fligner-Killeen:med chi-squared = 0.0070479, df = 1, p-value = 0.9331





	Fligner-Killeen test of homogeneity of variances

data:  npk$yield by npk$K
Fligner-Killeen:med chi-squared = 2.6046, df = 1, p-value = 0.1066
</code></pre>
</div>

      </div>


    </div>
  </div>



<!--Footer-->
<footer class="page-footer center-on-small-only">
<div id="gotop"><i class="fa fa-chevron-up" aria-hidden="true"></i></div>
  <!--Copyright-->
    <div class="footer-copyright">
        <div class="container-fluid">
            Â© 2017 Copyright: <a href="http://rse.shef.ac.uk"> RSE at Sheffield</a>

        </div>
    </div>
    <!--/.Copyright-->

</footer>
<!--/.Footer-->


</body>


</html>
